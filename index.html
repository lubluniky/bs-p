<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket HFT Kernel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        quant: {
                            bg: '#09090b',
                            panel: '#111113',
                            border: '#27272a',
                            text: '#a1a1aa',
                            textLight: '#f4f4f5',
                            bid: '#10b981',
                            ask: '#ef4444',
                            accent: '#3b82f6'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['"Fira Code"', '"Roboto Mono"', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #09090b;
            color: #a1a1aa;
            /* Subtle dot pattern for terminal feel */
            background-image: radial-gradient(#27272a 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .quant-panel {
            background-color: #111113;
            border: 1px solid #27272a;
            border-radius: 4px;
        }
        
        /* Ultra-strict terminal slider */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 2px;
            background: #27272a;
            outline: none;
            border-radius: 0;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 10px;
            height: 20px;
            background: #f4f4f5;
            cursor: pointer;
            border-radius: 2px;
            border: 1px solid #09090b;
        }
        
        .lang-btn {
            cursor: pointer;
            transition: color 0.2s;
        }
        .lang-btn.active {
            color: #f4f4f5;
            font-weight: 600;
        }
        
        .blink {
            animation: blinker 1.5s linear infinite;
        }
        @keyframes blinker {
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col items-center overflow-x-hidden font-sans">

    <!-- Header -->
    <nav class="w-full max-w-6xl flex justify-between items-center py-4 px-4 md:px-8 border-b border-quant-border bg-quant-bg/90 backdrop-blur sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <i data-lucide="cpu" class="text-quant-textLight w-6 h-6"></i>
            <span class="text-lg font-bold tracking-tight text-quant-textLight font-mono">PM_KERNEL</span>
        </div>
        <div class="flex items-center gap-6 text-sm font-mono">
            <a href="#demo" class="hover:text-quant-textLight transition-colors" data-i18n="nav_demo">SIMULATOR</a>
            <a href="#tech" class="hover:text-quant-textLight transition-colors" data-i18n="nav_tech">DOCS</a>
            <div class="flex items-center gap-2 border-l border-quant-border pl-6">
                <span class="lang-btn active" onclick="setLang('ru')">RU</span>
                <span class="text-quant-border">|</span>
                <span class="lang-btn" onclick="setLang('en')">EN</span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <main class="w-full max-w-6xl px-4 md:px-8 py-20 flex flex-col items-start">
        <div class="inline-flex items-center px-2 py-1 bg-quant-border/30 border border-quant-border text-xs font-mono mb-6 rounded-sm text-quant-textLight">
            <div class="w-2 h-2 bg-quant-accent rounded-full mr-2 blink"></div>
            C23 • Rust FFI • AVX-512 • Zero-Allocation
        </div>
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight mb-6 text-quant-textLight leading-tight uppercase font-sans" data-i18n="hero_title">
            Институциональное ядро<br>для Polymarket HFT
        </h1>
        <p class="text-lg md:text-xl max-w-3xl mb-10 leading-relaxed font-serif text-quant-text" data-i18n="hero_desc">
            Строгий вычислительный движок для алгоритмического маркет-мейкинга.
            Оценивает риски, котирует и хеджирует позиции по модели Logit Jump-Diffusion с наносекундной задержкой.
        </p>
    </main>

    <!-- Section: Interactive Demo -->
    <section id="demo" class="w-full max-w-6xl px-4 md:px-8 py-10">
        <h2 class="text-xl md:text-2xl font-bold mb-8 flex items-center gap-3 text-quant-textLight uppercase tracking-wider font-mono">
            <span class="w-1.5 h-6 bg-quant-accent"></span> 
            <span data-i18n="demo_title">СИМУЛЯТОР: ЛОГИТ-КОТИРОВАНИЕ</span>
            <div class="ml-auto flex items-center gap-2 text-xs text-quant-bid border border-quant-bid/30 bg-quant-bid/10 px-2 py-1 rounded-sm" id="liveIndicator">
                <div class="w-1.5 h-1.5 bg-quant-bid rounded-full blink"></div> LIVE DATA
            </div>
        </h2>
        
        <div class="grid lg:grid-cols-2 gap-6">
            <!-- Controls -->
            <div class="quant-panel p-6 md:p-8 flex flex-col gap-10 font-mono">
                <!-- Fair Price -->
                <div>
                    <div class="flex justify-between items-end mb-1">
                        <span class="text-xs text-quant-text uppercase tracking-wider" data-i18n="lbl_fair">РЫНОЧНЫЙ КОНСЕНСУС (MID PRICE)</span>
                        <span id="fairPriceVal" class="text-sm text-quant-textLight">50.0%</span>
                    </div>
                    <input type="range" id="fairPrice" min="1" max="99" step="0.1" value="50">
                </div>
                
                <!-- Inventory -->
                <div>
                    <div class="flex justify-between items-end mb-1">
                        <span class="text-xs text-quant-text uppercase tracking-wider" data-i18n="lbl_inv">ИНВЕНТАРЬ (ВАША ПОЗИЦИЯ)</span>
                        <span id="inventoryVal" class="text-sm text-quant-ask">-3</span>
                    </div>
                    <input type="range" id="inventory" min="-100" max="100" value="0">
                    <p class="text-[10px] text-quant-text/50 mt-3 max-w-[90%]" data-i18n="hint_inv">Положительный = длинная позиция. Модель сместит цены вниз для сброса риска.</p>
                </div>

                <!-- Volatility -->
                <div>
                    <div class="flex justify-between items-end mb-1">
                        <span class="text-xs text-quant-text uppercase tracking-wider" data-i18n="lbl_vol">ВОЛАТИЛЬНОСТЬ (SIGMA)</span>
                        <span id="volatilityVal" class="text-sm text-quant-textLight">20.0%</span>
                    </div>
                    <input type="range" id="volatility" min="1" max="50" step="0.1" value="20">
                    <p class="text-[10px] text-quant-text/50 mt-3 max-w-[90%]" data-i18n="hint_vol">Регулирует ширину спреда для защиты от токсичного потока ордеров.</p>
                </div>
            </div>

            <!-- Visualizer -->
            <div class="quant-panel p-6 md:p-8 flex flex-col relative font-mono">
                <h3 class="text-xs font-bold mb-8 uppercase text-quant-textLight border-b border-quant-border pb-3 tracking-widest" data-i18n="book_title">ГЛУБИНА СТАКАНА (L2 PROJECTION)</h3>
                
                <!-- Orderbook Projection Graph -->
                <div class="relative w-full h-32 border border-[#27272a] mb-10 overflow-hidden bg-[#09090b]">
                    <!-- Horizontal Center Line -->
                    <div class="absolute top-1/2 left-0 right-0 h-[1px] bg-[#27272a] -translate-y-1/2"></div>
                    
                    <!-- Mid Price Line -->
                    <div id="markFair" class="absolute top-0 bottom-0 border-l border-dashed border-[#a1a1aa]/30 z-0 transition-transform duration-75 ease-linear">
                    </div>

                    <!-- Bid Marker (Text is forced BELOW the center line) -->
                    <div id="markBid" class="absolute top-0 bottom-0 border-r border-[#10b981] z-10 transition-transform duration-75 ease-linear" style="transform: translateX(-100%);">
                        <span class="absolute right-2 top-[55%] text-[#10b981] text-[10px] font-bold">BID</span>
                    </div>

                    <!-- Ask Marker (Text is forced ABOVE the center line) -->
                    <div id="markAsk" class="absolute top-0 bottom-0 border-l border-[#ef4444] z-10 transition-transform duration-75 ease-linear">
                        <span class="absolute left-2 bottom-[55%] text-[#ef4444] text-[10px] font-bold">A</span>
                    </div>
                </div>

                <!-- Price Readouts -->
                <div class="w-full grid grid-cols-2 gap-4 mt-auto">
                    <div class="p-4 border border-quant-border bg-[#09090b] flex flex-col justify-center">
                        <span class="text-[10px] uppercase text-quant-text/50 mb-2 tracking-widest">BID PRICE</span>
                        <span id="outBid" class="text-2xl font-bold text-quant-bid">--</span>
                    </div>
                    <div class="p-4 border border-quant-border bg-[#09090b] flex flex-col justify-center">
                        <span class="text-[10px] uppercase text-quant-text/50 mb-2 tracking-widest">ASK PRICE</span>
                        <span id="outAsk" class="text-2xl font-bold text-quant-ask">--</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section: Hardcore Tech -->
    <section id="tech" class="w-full max-w-6xl px-4 md:px-8 py-10 mb-20">
        <h2 class="text-xl md:text-2xl font-bold mb-8 flex items-center gap-3 text-quant-textLight uppercase tracking-wider border-b border-quant-border pb-4 font-mono">
            <span data-i18n="tech_title">АРХИТЕКТУРА & МАТЕМАТИКА</span>
        </h2>

        <div class="grid lg:grid-cols-2 gap-6">
            <!-- Math -->
            <div class="quant-panel p-6 md:p-8">
                <h3 class="text-xs font-mono font-bold mb-5 uppercase text-quant-textLight tracking-widest">1. LOGIT JUMP-DIFFUSION</h3>
                <p class="text-sm mb-4 leading-relaxed font-serif text-quant-text" data-i18n="tech_math_1">
                    Адаптация модели Shaw & Dalen (2025). Для предотвращения нарушения границ $(0,1)$, вероятности трансформируются в логит-пространство:
                </p>
                <div class="bg-[#09090b] p-4 border border-quant-border mb-5 overflow-x-auto text-sm text-center">
                    $$x_t = \ln\left(\frac{p_t}{1-p_t}\right)$$
                </div>
                <p class="text-sm mb-4 leading-relaxed font-serif text-quant-text" data-i18n="tech_math_2">
                    Управление запасами (Авелланеда-Стойков) применяется к $x_t$, вычисляя резервную цену и риск-нейтральный спред:
                </p>
                <div class="bg-[#09090b] p-4 border border-quant-border mb-2 overflow-x-auto text-sm text-center">
                    $$r_x(t) = x_t - q_t \cdot \gamma \cdot \sigma_b^2 \cdot \tau$$
                    $$\delta_x(t) \approx \frac{1}{2}\gamma \sigma_b^2 \tau + \frac{1}{k}\ln\left(1+\frac{\gamma}{k}\right)$$
                </div>
            </div>

            <!-- Code/Tech -->
            <div class="quant-panel p-6 md:p-8">
                <h3 class="text-xs font-mono font-bold mb-5 uppercase text-quant-textLight tracking-widest">2. AVX-512 / ZERO-ALLOCATION</h3>
                <ul class="space-y-5 text-sm mb-8 font-serif">
                    <li>
                        <strong class="text-quant-textLight font-mono text-xs">Structure of Arrays (SoA)</strong>
                        <span class="block mt-1.5 text-quant-text leading-relaxed" data-i18n="tech_soa">Устранение медленных инструкций `gather`. Использование векторизованных загрузок `_mm512_loadu_pd` из последовательной памяти.</span>
                    </li>
                    <li>
                        <strong class="text-quant-textLight font-mono text-xs">Safe Rust FFI</strong>
                        <span class="block mt-1.5 text-quant-text leading-relaxed" data-i18n="tech_ffi">Передача закрепленных срезов (Pinned Slices) в C-ядро без аллокаций памяти (`malloc`) в горячем цикле.</span>
                    </li>
                    <li>
                        <strong class="text-quant-textLight font-mono text-xs">Custom SIMD Math</strong>
                        <span class="block mt-1.5 text-quant-text leading-relaxed" data-i18n="tech_simd">Аппроксимация `log1p` полиномами Хорнера и битовыми масками IEEE-754. Полное исключение скалярных вычислений.</span>
                    </li>
                </ul>
                
                <div class="bg-[#09090b] p-4 border border-quant-border font-mono text-[11px] leading-relaxed overflow-x-auto text-quant-accent/90">
<pre><code>// SIMD spread calc (No scalar fallback)
const __m512d gamma_over_k = _mm512_div_pd(gamma_v, k_v);
const __m512d linear_half_spread = _mm512_mul_pd(v_half, risk_term);

const __m512d non_linear = _mm512_div_pd(
    kernel_log1p_fast_avx512(gamma_over_k), 
    k_v
);

const __m512d delta_x = _mm512_add_pd(linear_half_spread, non_linear);</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="w-full py-8 border-t border-quant-border text-center text-xs font-mono text-quant-text/40 tracking-widest uppercase">
        <p>Built for the Centurion Enterprise ecosystem. Strict High Frequency Trading.</p>
    </footer>

    <script>
        // --- Initialization ---
        lucide.createIcons();

        // --- i18n Dictionary ---
        const i18n = {
            ru: {
                nav_demo: "СИМУЛЯТОР", nav_tech: "ДОКУМЕНТАЦИЯ",
                hero_title: "Институциональное ядро<br>для Polymarket HFT",
                hero_desc: "Строгий вычислительный движок для алгоритмического маркет-мейкинга. Оценивает риски, котирует, и хеджирует позиции по модели Logit Jump-Diffusion с наносекундной задержкой.",
                demo_title: "СИМУЛЯТОР: ЛОГИТ-КОТИРОВАНИЕ",
                lbl_fair: "РЫНОЧНЫЙ КОНСЕНСУС (MID PRICE)",
                lbl_inv: "ИНВЕНТАРЬ (ВАША ПОЗИЦИЯ)",
                hint_inv: "Положительный = длинная позиция. Модель сместит цены вниз для сброса риска.",
                lbl_vol: "ВОЛАТИЛЬНОСТЬ (SIGMA)",
                hint_vol: "Регулирует ширину спреда для защиты от токсичного потока ордеров.",
                book_title: "ГЛУБИНА СТАКАНА (L2 PROJECTION)",
                tech_title: "АРХИТЕКТУРА & МАТЕМАТИКА",
                tech_math_1: "Адаптация модели Shaw & Dalen (2025). Для предотвращения нарушения границ $(0,1)$, вероятности трансформируются в логит-пространство:",
                tech_math_2: "Управление запасами (Авелланеда-Стойков) применяется к $x_t$, вычисляя резервную цену и риск-нейтральный спред:",
                tech_soa: "Устранение медленных инструкций `gather`. Использование векторизованных загрузок `_mm512_loadu_pd` из последовательной памяти.",
                tech_ffi: "Передача закрепленных срезов (Pinned Slices) в C-ядро без аллокаций памяти (`malloc`) в горячем цикле.",
                tech_simd: "Аппроксимация `log1p` полиномами Хорнера и битовыми масками IEEE-754. Полное исключение скалярных вычислений."
            },
            en: {
                nav_demo: "SIMULATOR", nav_tech: "DOCS",
                hero_title: "Institutional Kernel<br>for Polymarket HFT",
                hero_desc: "A strict computational engine for algorithmic market making. Evaluates risks, quotes, and hedges positions using the Logit Jump-Diffusion model with nanosecond latency.",
                demo_title: "SIMULATOR: LOGIT QUOTING",
                lbl_fair: "MARKET CONSENSUS (MID PRICE)",
                lbl_inv: "INVENTORY (YOUR POSITION)",
                hint_inv: "Positive = Long position. The model shifts prices downward to offload risk.",
                lbl_vol: "VOLATILITY (SIGMA)",
                hint_vol: "Adjusts spread width to protect against toxic order flow (adverse selection).",
                book_title: "ORDERBOOK DEPTH (L2 PROJECTION)",
                tech_title: "ARCHITECTURE & MATHEMATICS",
                tech_math_1: "Adapted from Shaw & Dalen (2025). To prevent boundary violations at $(0,1)$, probabilities are mapped to the logit space:",
                tech_math_2: "Inventory-aware quoting (Avellaneda-Stoikov) is applied to $x_t$ to compute the reservation price and risk-neutral spread:",
                tech_soa: "Eliminates slow `gather` instructions. Uses contiguous vector loads `_mm512_loadu_pd` from memory.",
                tech_ffi: "Passes Pinned Slices to the C-kernel avoiding `malloc` allocations in the hot path.",
                tech_simd: "Approximates `log1p` using Horner's method and IEEE-754 bitmasks. Completely eliminates scalar execution fallback."
            }
        };

        // --- i18n Switcher ---
        function setLang(lang) {
            document.querySelectorAll('.lang-btn').forEach(el => {
                if(el.innerText.toLowerCase() === lang) el.classList.add('active');
                else el.classList.remove('active');
            });

            const dict = i18n[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(dict[key]) el.innerHTML = dict[key];
            });
            renderMath();
        }

        function renderMath() {
            if (typeof renderMathInElement === 'function') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            renderMath();
            setLang('ru');
        });

        // --- Demo Logic (Avellaneda-Stoikov Logit Simulator) ---
        const elFair = document.getElementById('fairPrice');
        const elFairVal = document.getElementById('fairPriceVal');
        const elInv = document.getElementById('inventory');
        const elInvVal = document.getElementById('inventoryVal');
        const elVol = document.getElementById('volatility');
        const elVolVal = document.getElementById('volatilityVal');
        
        const outBid = document.getElementById('outBid');
        const outAsk = document.getElementById('outAsk');
        
        const markBid = document.getElementById('markBid');
        const markFair = document.getElementById('markFair');
        const markAsk = document.getElementById('markAsk');
        const liveIndicator = document.getElementById('liveIndicator');

        function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }
        function logit(p) { 
            const pc = clamp(p, 0.001, 0.999);
            return Math.log(pc / (1 - pc)); 
        }
        function sigmoid(x) { return 1 / (1 + Math.exp(-x)); }

        function updateSimulation() {
            const p_fair = parseFloat(elFair.value) / 100.0;
            const q = parseFloat(elInv.value);
            const volLevel = parseFloat(elVol.value); 

            elFairVal.innerText = (p_fair * 100).toFixed(1) + "%";
            elInvVal.innerText = q;
            elInvVal.className = "text-sm " + (q > 0 ? "text-quant-bid" : (q < 0 ? "text-quant-ask" : "text-quant-textLight"));
            elVolVal.innerText = volLevel.toFixed(1) + "%";

            // AS Parameters
            const x_t = logit(p_fair);
            const gamma = 0.05; 
            const tau = 1.0; 
            const k = 5.0; 
            const sigma2 = (volLevel / 10.0) * (volLevel / 10.0); 

            // Core AS Logit Math
            const risk_term = gamma * sigma2 * tau;
            const r_x = x_t - (q * risk_term);
            const delta_x = (0.5 * risk_term) + (Math.log1p(gamma / k) / k);

            let bid_p = sigmoid(r_x - delta_x);
            let ask_p = sigmoid(r_x + delta_x);

            if (bid_p > ask_p) {
                const tmp = bid_p; bid_p = ask_p; ask_p = tmp;
            }

            outBid.innerText = (bid_p * 100).toFixed(2) + "¢";
            outAsk.innerText = (ask_p * 100).toFixed(2) + "¢";

            // Visualizer positioning
            markFair.style.left = `${p_fair * 100}%`;
            markBid.style.left = `${bid_p * 100}%`;
            markAsk.style.left = `${ask_p * 100}%`;
        }

        // --- Live Auto-Simulation Logic ---
        let autoSimulate = true;
        let targetFair = parseFloat(elFair.value);
        let interactionTimeout;

        function pauseAuto() {
            autoSimulate = false;
            liveIndicator.innerHTML = `<div class="w-1.5 h-1.5 bg-quant-text/50 rounded-full"></div> MANUAL`;
            liveIndicator.className = "ml-auto flex items-center gap-2 text-xs text-quant-text border border-quant-border bg-quant-bg px-2 py-1 rounded-sm";
            
            clearTimeout(interactionTimeout);
            interactionTimeout = setTimeout(() => { 
                autoSimulate = true; 
                targetFair = parseFloat(elFair.value); 
                liveIndicator.innerHTML = `<div class="w-1.5 h-1.5 bg-quant-bid rounded-full blink"></div> LIVE DATA`;
                liveIndicator.className = "ml-auto flex items-center gap-2 text-xs text-quant-bid border border-quant-bid/30 bg-quant-bid/10 px-2 py-1 rounded-sm";
            }, 3000); // Resume after 3 seconds of inactivity
        }

        elFair.addEventListener('input', () => { pauseAuto(); targetFair = parseFloat(elFair.value); updateSimulation(); });
        elInv.addEventListener('input', () => { pauseAuto(); updateSimulation(); });
        elVol.addEventListener('input', () => { pauseAuto(); updateSimulation(); });
        
        // Background tick loop simulating market data
        setInterval(() => {
            if (!autoSimulate) return;

            // 1. Random walk for fair price (Brownian motion)
            let drift = (Math.random() - 0.5) * 1.5; 
            targetFair = clamp(targetFair + drift, 10, 90);
            
            let currentFair = parseFloat(elFair.value);
            currentFair += (targetFair - currentFair) * 0.1; // Smooth interpolation
            currentFair += (Math.random() - 0.5) * 0.3; // Micro-noise
            elFair.value = clamp(currentFair, 1, 99);

            // 2. Simulate order flow (Inventory spikes)
            let inv = parseFloat(elInv.value);
            if (Math.random() < 0.06) { // 6% chance per tick to get filled
                let fillSize = Math.floor(Math.random() * 10) + 1;
                let dir = Math.random() > 0.5 ? 1 : -1;
                // Mean reversion: if we hold too much, more likely to get filled on the other side
                if (inv > 30) dir = -1;
                if (inv < -30) dir = 1;
                
                inv = clamp(inv + (fillSize * dir), -100, 100);
                elInv.value = inv;
            }

            // 3. Volatility breathing
            let vol = parseFloat(elVol.value);
            vol += (Math.random() - 0.5) * 0.6;
            if (vol > 45) vol -= 1;
            if (vol < 10) vol += 1;
            elVol.value = clamp(vol, 1, 50);

            updateSimulation();
        }, 80); // ~12 FPS update rate for smooth terminal feel

        updateSimulation();
    </script>
</body>
</html>
